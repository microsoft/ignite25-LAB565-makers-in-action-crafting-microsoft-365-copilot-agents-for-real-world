# Part 2 - Integrating Azure AI Search for RAG

In this lab module, you are going to understand how to enhance your Microsoft Copilot Studio agents with Retrieval-Augmented Generation (RAG) capabilities using Azure AI Search. You'll specialize the HR Candidate Management agent that you created in the previous module to search through candidate documents using vector search, providing intelligent, contextual responses backed by your organization's data. This lab demonstrates how to create powerful AI agents that combine the conversational abilities of Copilot Studio with the advanced search capabilities of Azure AI Search.

In this lab module you will learn:

- How to create and configure Azure AI Search service for knowledge indexing
- How to import and vectorize PDF documents using Azure AI Search
- How to integrate Azure AI Search as a knowledge source in Microsoft Copilot Studio
- How to create agents that leverage RAG for intelligent document search

### What is Retrieval-Augmented Generation (RAG)?

Retrieval-Augmented Generation (RAG) is a technique used in artificial intelligence to improve the quality of responses generated by language models. Here's a simple example to understand it better:

Imagine you have a smart assistant that can write answers to your questions. Sometimes, this assistant might not know everything it needs to give a great answer. To help with this, RAG lets the assistant look up information from a large collection of documents, similar to how you might search the internet for answers. After finding the relevant information, the assistant then uses this data to write a better, more accurate response.

So, RAG combines two steps:

- **Retrieval:** Finding relevant information from a big pool of data.
- **Generation:** Using that information to create a detailed and accurate response.

This way, RAG helps in providing more informed and useful answers, making it very effective for tasks like answering questions, writing articles, and assisting with research.

### Benefits of using Vector Search

Vector search is an advanced technique used to find information quickly and accurately based on its meaning rather than just matching exact words. Unlike traditional text-based search, which relies on exact keyword matches, vector search uses numeric vectors to find content that is similar to your query. This enables Vector search to handle:

- **Semantic or conceptual similarity:** Matching concepts that are similar in meaning even if they use different words (e.g., "recruitment" and "hiring").
- **Multilingual content:** Finding equivalent content across different languages (e.g., "resume" in English and "curriculum vitae" in Latin).
- **Multiple content types:** Searching across different formats (e.g., text documents, and PDFs).

Here is how vector search works:

1. **Converting text to vectors:** Text or documents are turned into a series of numbers (a vector) that captures the essence or meaning of that content. This is done using embedding models.
2. **Storing vectors:** These vectors are stored in a special database (for example an Azure AI Search index) designed to handle them efficiently.
3. **Searching with vectors:** When you search for something, your query is also converted into a vector. The search system then looks for vectors in the index that are close to your query vector in terms of meaning.

For example, if you search for "software engineering skills," the system can find candidates with "programming expertise" or "development capabilities" even if they don't have the exact words from your search query.

## Exercise 1: Creating and Populating the Search Index

In this exercise you are going to configure the Azure AI Search service that will serve as the knowledge foundation for your RAG-enabled agent.

Specifically, in this lab module you are going to rely on a series of pre-provisioned Azure services as follows:

- **Azure AI Search**: the search service instance where the vector index will be stored
- **Azure Storage Account**: used to store a list of resume files used as the knowledge base of the agent
- **Azure OpenAI**: used to process the content of the resume files relying on a model (**text-embedding-ada-002**) specifically designed to vectorize text documents

### What does text-embedding-ada-002 do?

The **text-embedding-ada-002** model on Azure OpenAI converts text into numeric vectors that represent the meaning of the text. This allows for vector search, where instead of matching exact words, the search finds text with similar meanings. It works with multiple languages and different content types, making it useful for comparing text across languages and formats. When used with Azure AI Search, it improves search results by finding the most relevant and contextually accurate information. This model is perfect for creating advanced search solutions and applications that need to understand natural language.

The text embedding model is essential for converting both the indexed documents and user queries into vectors that can be compared for semantic similarity.

In this exercise you will create a search index in Azure AI Search and populate it with candidate resume documents using the integrated vectorization feature.

### Step 1: Inspecting Sample Documents

Open the folder `c:\labs\fictitious_resumes` on your lab environment and inspect the list of resume PDF files that you will use as the knowledge base for the agent.

These sample resumes contain diverse candidate profiles with information such as:

- Candidate names and contact information
- Technical skills and expertise areas
- Work experience and role history
- Education backgrounds
- Language proficiencies
- Professional certifications

Review the content of these files to understand the type of information that will be searchable through your RAG-enabled agent. Notice also that the documents are written in various languages. This will not be a problem for the **text-embedding-ada-002** model or for the vector index.

### Step 2: Uploading sample documents in the Storage Account

Using Azure AI Search, you'll create a vector index with your resume documents using the integrated vectorization feature.

Navigate to +++https://portal.azure.com/+++ and login with the Microsoft 365 work or school account available in the **Resources** tab:

**Username: +++@lab.CloudPortalCredential(User1).Username+++**

**Temporary Access Pass: +++@lab.CloudPortalCredential(User1).AccessToken+++**

Skip the Azure tour, unless you want to go through it.

![The Azure burger menu with the "Resource groups" item highlighted.](https://raw.githubusercontent.com/microsoft/ignite25-LAB565-makers-in-action-crafting-microsoft-365-copilot-agents-for-real-world/refs/heads/main/img/azure-resource-group-01.png)

Then, select the burger menu in the upper-left side of the screen, select **Resource groups** to open the list of resource groups, and select the resource group with name **LAB565-ResourceGroup**. 

![The list of Azure resource groups with the "LAB565-ResourceGroup" item highlighted.](https://raw.githubusercontent.com/microsoft/ignite25-LAB565-makers-in-action-crafting-microsoft-365-copilot-agents-for-real-world/refs/heads/main/img/azure-resource-group-02.png)

In the resource group you will find three pre-provisioned services:

- **lab565-openai-[unique-value]**: an Azure OpenAI service instance
- **lab565-search-[unique-value]**: an Azure AI Search service instance
- **lab565[unique-value]**: an Azure Storage Account service instance

![The list of pre-provisioned resources in the "LAB565-ResourceGroup" resource group on Azure. The Storage Account is highlighted.](https://raw.githubusercontent.com/microsoft/ignite25-LAB565-makers-in-action-crafting-microsoft-365-copilot-agents-for-real-world/refs/heads/main/img/azure-resource-group-03.png)

Select and open the pre-provisioned Azure Storage Account service instance.

1. Select the **Containers** in the **Data storage** group of commands in the left navigation
1. Select the container with name **resumes** to access its content
1. Select 1️⃣ **Upload**
1. Drag and drop the resume files or select 2️⃣ **Browse for files** and select the resume files
1. Select the 3️⃣ **Upload** command and wait for the upload to complete

![The Azure Storage Account service instance while uploading files in target container. The commands to upload files are highlighted.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/azure-storage-03.png)

### Step 3: Populating the Vector Index with Integrated Vectorization

Once the resume files are uploaded go back to the home page of the +++https://portal.azure.com/+++, go back to the **LAB565-ResourceGroup** resource group, and select the Azure AI Search service instance. 

![The list of pre-provisioned resources in the "LAB565-ResourceGroup" resource group on Azure. The Search Service is highlighted.](https://raw.githubusercontent.com/microsoft/ignite25-LAB565-makers-in-action-crafting-microsoft-365-copilot-agents-for-real-world/refs/heads/main/img/azure-ai-search-01.png)

Then select the **Import data (new)** command in the top command bar.

![The Azure AI Search service instance overview page with basic information about the service instance. There is a command to "Import data (new)" highlighted.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/azure-search-02.png)

A new page will show up, through which you can configure the data import process. Select the **Azure Blob Storage** data source.

![The Azure AI Search service instance page to start importing data. There is the "Azure Blob Storage" data source highlighted.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/azure-search-03.png)

Right after, select **RAG** as the scenario that you are targeting.

![The Azure AI Search service instance page to choose the target scenario. There is the "RAG" scenario highlighted.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/azure-search-04.png)

Now configure the RAG scenario accordingly to the following settings:

1. **Configure your Azure Blob Storage** section:

    - **Subscription:** Your Azure subscription
    - **Storage account:** the Storage Account that you can find in the resource group of this lab
    - **Blob container:** the **resumes** container that you find in the Storage Account
    - **Blob folder:** you can leave it blank, unless you created a folders structure in the storage container
    - **Parsing mode:** use the **Default** value
    - Move **Next**

1. **Vectorize your text** section:

    - **Kind:** Azure OpenAI
    - **Subscription:** Your Azure subscription
    - **Azure Open AI service:** select the Azure OpenAI that you can find in the resource group of this lab
    - **Model deployment:** select the **text-embeddings** model
    - **Authentication type:** the default **API Key** value is ok
    - Check the box to declare *"I acknowledge that connecting to an Azure OpenAI service will incur additional costs to my account"*.
    - Move **Next**

1. **Vectorize your images** section:

    - In case you are willing to process images and text in images, you could configure specific settings
    - Here you can simply move **Next**

1. **Advanced ranking and relevancy** section:

    - If you like you can schedule recurring updates of the index, on a timer based model. You can also choose whether to use the semantic ranker to get results also based on semantic and not only on lexical analysis. Last but not least, you can configure the fields that will be created in the target index
    - Here you can simply move **Next**

1. **Review and create** section:

    - Here you can provide a prefix for the index, indexer, data source, and skillset that will be created. Use `resumes` for this index
    - Review the settings and when you are ready select **Create** to create and feed the vector index

![The Azure AI Search service instance page to recap the settings that will be applied when creating and feeding the vector index.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/azure-search-05.png)

Once the vector index is created, a small dialog confirms the index creation and availability. Select the **Start searching** command to start playing with the index. In the search index page, you can simply select the **Search** command and see the output. Notice that, for every value in the index, you also have a **text_vector** field that contains the text vectorized using the **text-embedding-ada-002** model.

![The Azure AI Search vector index showing the results of a get all query with the "text_vector" field highlighted.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/azure-search-06.png)

Now browse to the **Overview** page of the Azure AI Search service instance and copy the URL of the service in a safe place.

![The Azure AI Search overview page with the "URL" property highlighted.](https://raw.githubusercontent.com/microsoft/ignite25-LAB565-makers-in-action-crafting-microsoft-365-copilot-agents-for-real-world/refs/heads/main/img/azure-ai-search-settings-01.png)

Then, select the **Settings** group of items in the left navigation bar, select **Keys**, and select the command to copy the **Primary admin key** into the clipboard. Paste it in a safe place, together with the service URL.

![The Azure AI Search "keys" page with the command to copy the "Primary admin key" highlighted.](https://raw.githubusercontent.com/microsoft/ignite25-LAB565-makers-in-action-crafting-microsoft-365-copilot-agents-for-real-world/refs/heads/main/img/azure-ai-search-settings-02.png)

## Exercise 2: Creating the RAG-Enabled Agent

In this exercise you will update the Microsoft Copilot Studio agent that you created in the previous module to leverage your Azure AI Search index providing intelligent, document-backed responses about HR candidates.

### Step 1: Updating the HR Candidate Management agent

Navigate to +++https://copilotstudio.microsoft.com+++ and open the **HR Candidate Management** agent.

![The agent "Overview" section with the "Edit" command to edit the "Instructions" highlighted.](https://raw.githubusercontent.com/microsoft/ignite25-LAB565-makers-in-action-crafting-microsoft-365-copilot-agents-for-real-world/refs/heads/main/img/mcs-agent-edit-instructions-01.png)

In the **Overview** section, select the **Edit** button of the **Instructions** section and update the agent's instructions as follows

- **Instructions**: 

```
You are a helpful HR assistant that specializes in candidate management. You can help users search for candidates, check their availability, get detailed candidate information, and add new candidates to the system. 

You also have access to a comprehensive database of candidate resumes through advanced 
vector search capabilities.

When users ask questions, you should:

1. Search through the candidate database using semantic understanding
2. Provide detailed, accurate information based on the indexed documents
3. Always include proper citations and references to source documents
4. Explain your reasoning when matching candidates to requirements
5. Suggest alternative candidates when exact matches are not available
6. Help users understand the skills and qualifications of different candidates

You excel at:
- Finding candidates with specific technical skills
- Matching language requirements with candidate profiles
- Identifying experience levels and career progression
- Understanding educational backgrounds and certifications
- Semantic search that goes beyond keyword matching

Always provide helpful, accurate information while respecting privacy and being professional.
```

Once the agent instructions are updated, double check that the option to **Use generative AI to determine how best to respond to users and events** is enabled, in order to have the Generative AI based orchestrator configured. Also verify that **GPT-4o** model is selected in the **Details** panel of the agent's settings.

![The Microsoft Copilot Studio settings for the new agent with Generative Orchestrator enabled and GPT-4o model highlighted.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/mcs-agent-02.png)

Now, select **Tools** and disable the MCP server that you configured in the previous module of this lab. Starting from now, the knowledge base of your agent will be the one stored in Azure AI Search.

![The "Tools" page of the Copilot Studio agent with the MCP server tool disabled.](https://raw.githubusercontent.com/microsoft/ignite25-LAB565-makers-in-action-crafting-microsoft-365-copilot-agents-for-real-world/refs/heads/main/img/mcs-mcp-tool-disabled-01.png)

### Step 2: Adding Azure AI Search as Knowledge Source

Integrate your Azure AI Search index as a knowledge source for your agent.

Navigate to the **Knowledge** section and add your search index:

1. Select **+ Add knowledge**
1. From the **Add knowledge** dialog, select **Featured**
1. Select **Azure AI Search**

![The knowledge sources interface showing the option to add Azure AI Search as a featured knowledge source, with various other knowledge source options visible.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/mcs-add-knowledge-01.png)

Configure the Azure AI Search connection:

1. Select **Create new connection**
1. Configure the authentication:

    - **Authentication type:** Access Key
    - **Azure AI Search Endpoint URL:** Enter the URL you saved from your Azure AI Search service
    - **Azure AI Search Admin Key:** Enter the admin key you copied earlier

1. Select **Create** to establish the connection (a green checkmark confirms success)

![The Azure AI Search connection configuration dialog showing the authentication type selection, endpoint URL field, and admin key field for establishing the connection.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/mcs-add-knowledge-02.png)

Complete the knowledge source configuration:

1. Select the index with name **resumes** (or whatever else name you used when you created the index)
1. Select **Add to agent** to complete the integration

![The Azure AI Search connection configuration dialog allowing you to select the index to use as the new knowledge base in the agent.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/mcs-add-knowledge-03.png)

The knowledge source will appear in your knowledge sources table with a status of "In progress" while Copilot Studio indexes the metadata. Wait for the status to change to "Ready" before proceeding.

## Exercise 3: Testing the agent

In this exercise you will test your RAG-enabled agent and learn how to leverage different types of queries and use cases.

### Step 1: Testing Basic Knowledge Retrieval

Start by testing fundamental search capabilities to ensure your agent can access and use the indexed knowledge effectively.

In the test panel, try these basic queries to validate the knowledge integration:

```
Hello! Can you help me find candidates with software engineering experience?
```

```
I am looking for candidates who speak multiple languages. Can you help?
```

```
Show me candidates with machine learning or AI experience.
```

![The test panel showing a conversation with the HR Knowledge Agent where the user asks about software engineering candidates and receives detailed responses with proper citations from the indexed documents.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/mcs-agent-03.png)

Observe how the agent:

- Searches through the indexed documents using vector search
- Provides relevant candidate information
- Includes citations and references to source documents
- Uses semantic understanding rather than exact keyword matching

### Step 2: Testing Complex Query Scenarios (bonus step)

This is a bonus step and it should take up to 5 mins to complete. Depending on the leftover time you can skip it or you can go through it.

Test more sophisticated scenarios that demonstrate the power of RAG and vector search capabilities.

Try these advanced queries that combine multiple requirements:

```
Find candidates suitable for a senior role that requires 5+ years of Python experience and fluency in Spanish
```

```
I need someone with both frontend and backend development skills. Who would be good for a full-stack position?
```

```
Can you recommend candidates for a data science position that requires experience with machine learning frameworks?
```

```
Who has project management experience combined with technical skills?
```

![The test panel showing complex multi-criteria queries with the agent providing detailed candidate recommendations, explanations of market insights, and suggestions for the best candidate to select.](https://microsoft.github.io/copilot-camp/assets/images/make/copilot-studio-08/mcs-agent-04.png)

Notice how the agent:

- Combines multiple search criteria intelligently
- Explains the reasoning behind candidate recommendations
- Suggests alternatives when exact matches aren't available
- Provides context about candidate qualifications
